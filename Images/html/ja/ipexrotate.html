
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- This HTML was auto-generated from MATLAB code. To make changes, update the MATLAB code and republish this document.       --><title>歪んだイメージの回転およびスケールを検出</title><meta name="generator" content="MATLAB 7.14"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2011-11-15"><meta name="DC.source" content="ipexrotate.m"><link rel="stylesheet" type="text/css" href="../../../../matlab/helptools/private/style.css"><link rel="stylesheet" type="text/css" href="../../../../matlab/helptools/private/style_ja_JP.css"></head><body><div class="header"><div class="left"><a href="matlab:edit ipexrotate">エディターで ipexrotate.m を開く</a></div><div class="right"><a href="matlab:echodemo ipexrotate">コマンド ウィンドウで実行</a></div></div><div class="content"><h1>歪んだイメージの回転およびスケールを検出</h1><!--introduction--><p>あるイメージが回転とスケールの変更によってのみ他と比較して変形していることを知っている場合、<tt>cp2tform</tt> を使用して、回転角と倍率を見つけることができます。その後、元のイメージを復元するために歪んだイメージを変換することができます。</p><!--/introduction--><h2>目次</h2><div><ul><li><a href="#1">手順 1: イメージの読み取り</a></li><li><a href="#2">手順 2: イメージのサイズ変更と回転</a></li><li><a href="#3">手順 3: コントロール ポイントの選択</a></li><li><a href="#6">手順 4: 変換の推定</a></li><li><a href="#8">手順 5: スケールと角度の解</a></li><li><a href="#10">手順 6: 元のイメージの復元</a></li></ul></div><h2>手順 1: イメージの読み取り<a name="1"></a></h2><p>イメージをワークスペースに読み取ります。</p><pre class="codeinput">original = imread(<span class="string">'cameraman.tif'</span>);
imshow(original);
text(size(original,2),size(original,1)+15, <span class="keyword">...</span>
    <span class="string">'Image courtesy of Massachusetts Institute of Technology'</span>, <span class="keyword">...</span>
    <span class="string">'FontSize'</span>,7,<span class="string">'HorizontalAlignment'</span>,<span class="string">'right'</span>);
</pre><img vspace="5" hspace="5" src="../ipexrotate_01.png" alt=""> <h2>手順 2: イメージのサイズ変更と回転<a name="2"></a></h2><pre class="codeinput">scale = 0.7;
distorted = imresize(original,scale); <span class="comment">% Try varying the scale factor.</span>

theta = 30;
distorted = imrotate(distorted,theta); <span class="comment">% Try varying the angle, theta.</span>
figure, imshow(distorted)
</pre><img vspace="5" hspace="5" src="../ipexrotate_02.png" alt=""> <h2>手順 3: コントロール ポイントの選択<a name="3"></a></h2><p>コントロール ポイントの選択ツールを使用して、少なくとも 2 組のコントロール ポイントを選択します。</p><pre class="codeinput">input_points = [151.52  164.79; 131.40 79.04];
base_points = [135.26  200.15; 170.30 79.30];
</pre><p>事前に選択されたポイントを使用してこの例の残りを実行できますが、自分でポイントを選択して結果が異なることを確認してください。</p><pre>cpselect(distorted,original,input_points,base_points);</pre><p><b></b>[ファイル] メニュー、<b></b>[ポイントをワークスペースへ保存] オプションを選択して、コントロール ポイントを保存します。ポイントを保存して変数 <tt>input_points</tt> と <tt>base_points</tt> を上書きします。</p><h2>手順 4: 変換の推定<a name="6"></a></h2><p>コントロール ポイントの数に合わせて適切な <tt>TFORM</tt> 構造体を検出します。</p><pre class="codeinput">t = cp2tform(input_points,base_points,<span class="string">'nonreflective similarity'</span>);
</pre><p>手順 5 および手順 6 の終了後、'nonreflective similarity' の代わりに 'affine' を使用して、手順 4 から手順 6 までを繰り返してください。 何が起こりますか? 結果は 'nonreflective similarity' を使用した場合と同じですか?</p><h2>手順 5: スケールと角度の解<a name="8"></a></h2><p><tt>TFORM</tt> 構造体 <tt>t</tt> は、<tt>t.tdata.Tinv</tt> に変換行列を含んでいます。変換には回転およびスケールのみが含まれているのがわかっているため、スケールと角度を復元する計算は比較的簡単です。</p><pre>Let sc = s*cos(theta)
Let ss = s*sin(theta)</pre><pre>Then, Tinv = t.tdata.Tinv = [sc -ss  0;
ss  sc  0;
tx  ty  1]</pre><pre>where tx and ty are x and y translations, respectively.</pre><pre class="codeinput">ss = t.tdata.Tinv(2,1);
sc = t.tdata.Tinv(1,1);
scale_recovered = sqrt(ss*ss + sc*sc)
theta_recovered = atan2(ss,sc)*180/pi
</pre><pre class="codeoutput">
scale_recovered =

    0.7000


theta_recovered =

   29.3741

</pre><p><tt>scale_recovered</tt> および <tt>theta_recovered</tt> の復元された値が<b>「手順 2: イメージのサイズ変更と回転」</b>で選択したスケール値および角度値と一致しなければなりません。</p><h2>手順 6: 元のイメージの復元<a name="10"></a></h2><p><tt>TFORM</tt> 構造体 <tt>t</tt> および <tt>original</tt> のサイズに関する知識を使用して、回転およびスケーリングされたイメージ <tt>distorted</tt> を変換することにより、元のイメージを復元します。</p><pre class="codeinput">D = size(original);
recovered = imtransform(distorted,t,<span class="string">'XData'</span>,[1 D(2)],<span class="string">'YData'</span>,[1 D(1)]);
</pre><p>モンタージュで <tt>recovered</tt> と <tt>original</tt> を並べて比較します。</p><pre class="codeinput">figure, imshowpair(original,recovered,<span class="string">'montage'</span>)
</pre><img vspace="5" hspace="5" src="../ipexrotate_03.png" alt=""> <p>歪みと復元のプロセスであるため、<tt>recovered</tt> (右) の画質は <tt>original</tt> (左) の画質と一致しません。特に、イメージを縮小すると情報が失われます。境界線周辺が不自然になるのは、変換の精度が限られているためです。<b>「手順 3:コントロール ポイントの選択」</b>で多くのポイントを選択すると、変換はより正確になります。</p><p class="footer">Copyright 1993-2011 The MathWorks, Inc.<br>Published with MATLAB&reg; 7.13</p><p class="footer" id="trademarks">MATLAB and Simulink are registered trademarks of The MathWorks, Inc.  Please see <a href="http://www.mathworks.com/trademarks">www.mathworks.com/trademarks</a> for a list of other trademarks owned by The MathWorks, Inc.  Other product or brand names are trademarks or registered trademarks of their respective owners.</p></div><!-- ##### SOURCE BEGIN ##### %% Finding the Rotation and Scale of a Distorted Image % If you know that one image is distorted relative to another only by a % rotation and scale change, you can use |cp2tform| to find the rotation % angle and scale factor. You can then transform the distorted image to % recover the original image.  % Copyright 1993-2011 The MathWorks, Inc.  % $Revision: 1.1.8.5 $ $Date: 2012/02/14 03:31:36 $  %% Step 1: Read Image % Read an image into the workspace.  original = imread('cameraman.tif'); imshow(original); text(size(original,2),size(original,1)+15, ...     'Image courtesy of Massachusetts Institute of Technology', ...     'FontSize',7,'HorizontalAlignment','right');  %% Step 2: Resize and Rotate the Image  scale = 0.7; distorted = imresize(original,scale); % Try varying the scale factor.  theta = 30; distorted = imrotate(distorted,theta); % Try varying the angle, theta. figure, imshow(distorted)  %% Step 3: Select Control Points % Use the Control Point Selection Tool to pick at least two pairs of % control points.   input_points = [151.52  164.79; 131.40 79.04]; base_points = [135.26  200.15; 170.30 79.30];  %% % You can run the rest of the example with these pre-picked points, but  % try picking your own points to see how the results vary. % %  cpselect(distorted,original,input_points,base_points);  %% % Save control points by choosing the *File* menu, then the *Save Points to % Workspace* option. Save the points, overwriting variables |input_points| % and |base_points|.  %% Step 4: Estimate Transformation % Find a |TFORM| structure that is consistent with your control points.  t = cp2tform(input_points,base_points,'nonreflective similarity');  %% % After you have done Steps 5 and 6, repeat Steps 4 through 6 but try using % 'affine' instead of 'nonreflective similarity'. What happens? Are the results % as good as they were with 'nonreflective similarity'?  %% Step 5: Solve for Scale and Angle % The |TFORM| structure, |t|, contains a transformation matrix in % |t.tdata.Tinv|. Since you know that the transformation includes only % rotation and scaling, the math is relatively simple to recover the scale % and angle. % %  Let sc = s*cos(theta) %  Let ss = s*sin(theta) % %  Then, Tinv = t.tdata.Tinv = [sc -ss  0; %                               ss  sc  0; %                               tx  ty  1] % %  where tx and ty are x and y translations, respectively.  ss = t.tdata.Tinv(2,1); sc = t.tdata.Tinv(1,1); scale_recovered = sqrt(ss*ss + sc*sc) theta_recovered = atan2(ss,sc)*180/pi  %% % The recovered values of |scale_recovered| and |theta_recovered| should match % the values you set in *Step 2: Resize and Rotate the Image*.  %% Step 6: Recover Original Image % Recover the original image by transforming |distorted|, the rotated-and-scaled % image, using |TFORM| structure |t| and what you know about the size of % |original|.  D = size(original); recovered = imtransform(distorted,t,'XData',[1 D(2)],'YData',[1 D(1)]);  %% % Compare |recovered| to |original| by looking at them side-by-side in a montage. figure, imshowpair(original,recovered,'montage')  %% % The |recovered| (right) image quality does not match the |original| (left) % image because of the distortion and recovery process. In particular, the image % shrinking causes loss of information. The artifacts around the edges are due % to the limited accuracy of the transformation.  If you were to pick more % points in *Step 3: Select Control Points*, the transformation would be more % accurate.  displayEndOfDemoMessage(mfilename)   ##### SOURCE END ##### --></body></html>